{% extends 'base.html' %}

{% block title %}Login - EduPay Africa{% endblock %}

{% block content %}

<!-- Page Header -->
<div class="page-header">
    <div class="container-lg">
        <h1>Login to Your Account</h1>
        <p>Secure access to EduPay Africa for authorized institutions and team members.</p>
    </div>
</div>

<div class="container-lg py-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div style="background: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <h3 style="color: var(--primary-color); font-weight: 700; text-align: center; margin-bottom: 10px;">Sign In</h3>
                <p style="text-align: center; color: #666; margin-bottom: 30px;">Enter your credentials to access your account</p>

                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}

                <!-- Firebase Auth Container -->
                <div id="firebaseui-auth-container"></div>

                <!-- Alternative Login Methods -->
                <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid var(--light-bg);">
                    <p style="text-align: center; color: #999; font-size: 0.9rem; margin-bottom: 20px;">
                        Or continue with email
                    </p>

                    <form method="post" action="." novalidate id="loginForm">
                        {% csrf_token %}

                        <div class="mb-4">
                            <div class="form-group">
                                <label for="email">Email Address <span style="color: red;">*</span></label>
                                <input 
                                    type="email" 
                                    class="form-control" 
                                    id="email" 
                                    name="email" 
                                    placeholder="your.email@example.com"
                                    required
                                >
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="form-group">
                                <label for="password">Password <span style="color: red;">*</span></label>
                                <input 
                                    type="password" 
                                    class="form-control" 
                                    id="password" 
                                    name="password" 
                                    placeholder="Enter your password"
                                    required
                                >
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="form-check">
                                <input 
                                    class="form-check-input" 
                                    type="checkbox" 
                                    id="remember" 
                                    name="remember"
                                >
                                <label class="form-check-label" for="remember">
                                    Remember me on this device
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary-custom btn-lg w-100">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </button>
                    </form>

                    <div style="text-align: center; margin-top: 15px;">
                        <a href="#forgot" style="color: var(--primary-color); text-decoration: none; font-size: 0.9rem;">
                            Forgot your password?
                        </a>
                    </div>
                </div>

                <!-- Create Account Link -->
                <div style="text-align: center; margin-top: 30px; padding-top: 30px; border-top: 2px solid var(--light-bg);">
                    <p style="color: #666; margin-bottom: 15px;">New to EduPay Africa?</p>
                    <a href="/demo/" class="btn btn-outline-primary w-100">
                        <i class="fas fa-calendar-alt"></i> Request a Demo
                    </a>
                </div>
            </div>

            <!-- Info Cards -->
            <div style="margin-top: 40px;">
                <div style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); color: white; padding: 25px; border-radius: 10px; margin-bottom: 20px;">
                    <h5 style="margin-bottom: 15px; font-weight: 700;">
                        <i class="fas fa-shield-alt"></i> Secure Login
                    </h5>
                    <p style="margin: 0; font-size: 0.9rem;">
                        Your login is protected with Firebase Authentication. Your credentials are encrypted and secure.
                    </p>
                </div>

                <div style="background: linear-gradient(135deg, var(--secondary-color) 0%, var(--accent-color) 100%); color: white; padding: 25px; border-radius: 10px;">
                    <h5 style="margin-bottom: 15px; font-weight: 700;">
                        <i class="fas fa-lock"></i> Privacy Protection
                    </h5>
                    <p style="margin: 0; font-size: 0.9rem;">
                        We never share your personal information. Your data is stored securely and accessed only by authorized personnel.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Support Section -->
    <div style="background: var(--light-bg); padding: 40px; border-radius: 10px; margin-top: 60px; text-align: center;">
        <h3 style="color: var(--primary-color); font-weight: 700; margin-bottom: 20px;">Need Help?</h3>
        <p style="color: #666; margin-bottom: 20px;">
            If you don't have an account yet or need assistance with login, our support team is here to help.
        </p>
        <div>
            <a href="/contact/" class="btn btn-primary-custom me-2">
                <i class="fas fa-envelope"></i> Contact Support
            </a>
            <a href="/demo/" class="btn btn-outline-primary">
                <i class="fas fa-calendar-alt"></i> Request Demo Access
            </a>
        </div>
    </div>
</div>

<!-- Firebase Auth UI Script -->
<script src="https://cdn.firebase.com/libs/firebaseui/6.0.0/firebaseui.js"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/6.0.0/firebaseui.css" />

<script>
    // Note: Firebase configuration should be loaded from your settings
    // This is a placeholder - configure according to your Firebase project
    
    // Initialize Firebase (if not already done in base template)
    // const firebaseConfig = {
    //   apiKey: "YOUR_API_KEY",
    //   authDomain: "YOUR_AUTH_DOMAIN",
    //   projectId: "YOUR_PROJECT_ID",
    //   storageBucket: "YOUR_STORAGE_BUCKET",
    //   messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    //   appId: "YOUR_APP_ID"
    // };
    // firebase.initializeApp(firebaseConfig);

    // // Initialize FirebaseUI
    // var ui = new firebaseui.auth.AuthUI(firebase.auth());
    // var uiConfig = {
    //   callbacks: {
    //     uiShown: function() {
    //       document.getElementById('loader').style.display = 'none';
    //     },
    //     signInSuccessWithAuthResult: function(authResult, redirectUrl) {
    //       // Send token to Django backend for verification
    //       authResult.user.getIdToken().then(function(idToken) {
    //         // Send to Django
    //         fetch('/auth/firebase-login/', {
    //           method: 'POST',
    //           headers: {
    //             'Content-Type': 'application/json',
    //             'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
    //           },
    //           body: JSON.stringify({ idToken: idToken })
    //         })
    //         .then(response => response.json())
    //         .then(data => {
    //           if (data.success) {
    //             window.location.href = redirectUrl || '/dashboard/';
    //           }
    //         });
    //       });
    //       return false;
    //     }
    //   },
    //   signInOptions: [
    //     firebase.auth.EmailAuthProvider.PROVIDER_ID,
    //     firebase.auth.PhoneAuthProvider.PROVIDER_ID,
    //   ],
    //   tosUrl: '/terms/',
    //   privacyPolicyUrl: '/privacy/',
    //   credentialHelper: firebaseui.auth.CredentialHelper.ACCOUNT_CHOOSER
    // };

    // if (document.getElementById('firebaseui-auth-container')) {
    //   ui.start('#firebaseui-auth-container', uiConfig);
    // }
</script>

<!-- Custom Validation -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('loginForm');
        if (form) {
            form.addEventListener('submit', function(e) {
                if (!form.checkValidity() === false) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                form.classList.add('was-validated');
            });
        }
    });
</script>

{% endblock %}
